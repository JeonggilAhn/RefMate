#!/bin/sh

# ì»¤ë°‹ ë©”ì‹œì§€ íŒŒì¼ ê²½ë¡œ
commit_msg_file=$1

# ì»¤ë°‹ ë©”ì‹œì§€ ì½ê¸°
commit_msg=$(cat "$commit_msg_file")

# í—ˆìš©ë˜ëŠ” prefix ëª©ë¡ê³¼ í•´ë‹¹í•˜ëŠ” ì´ëª¨ì§€
declare -A emoji_map
emoji_map["feat"]="âœ¨"
emoji_map["fix"]="ðŸ›"
emoji_map["docs"]="ðŸ“"
emoji_map["style"]="ðŸŽ¨"
emoji_map["refactor"]="â™»ï¸"
emoji_map["test"]="â˜‘ï¸"
emoji_map["chore"]="âš™ï¸"
emoji_map["hotfix"]="ðŸ‘º"

# í—ˆìš©ë˜ëŠ” prefix ëª©ë¡
allowed_prefixes=(feat fix docs style refactor test chore hotfix)

# prefix ê²€ì‚¬
is_valid=false
prefix_found=""
for prefix in "${allowed_prefixes[@]}"; do
  if [[ "$commit_msg" == "$prefix : "* ]]; then
    is_valid=true
    prefix_found=$prefix
    break
  fi
done

# ìœ íš¨í•˜ì§€ ì•Šì€ prefixì¸ ê²½ìš° ì»¤ë°‹ ê±°ë¶€
if ! $is_valid; then
  echo "Error: ì»¤ë°‹ ë©”ì‹œì§€ prefixê°€ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤."
  echo "í—ˆìš©ë˜ëŠ” prefix: ${allowed_prefixes[*]}"
  echo "prefix í›„ì— ë„ì–´ì“°ê¸°ë¥¼ í•´ì£¼ì„¸ìš”."
  exit 1
fi

# ì´ëª¨ì§€ê°€ ì´ë¯¸ ìžˆëŠ”ì§€ í™•ì¸
if [[ "$commit_msg" =~ ^[[:space:]]*[[:punct:]].*$ ]]; then
  exit 0
fi

# ì´ëª¨ì§€ ì¶”ê°€
emoji="${emoji_map[$prefix_found]}"
new_commit_msg="$emoji $commit_msg"
echo "$new_commit_msg" > "$commit_msg_file"
